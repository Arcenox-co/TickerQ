const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["tickerqassets/ConfirmDialog-CY5nDLOI.js","tickerqassets/_plugin-vue_export-helper-CEavA9-_.js","tickerqassets/index-Byj9w34-.js","tickerqassets/index-9ePG4d-9.css","tickerqassets/_plugin-vue_export-helper-BbU2hx5y.css","tickerqassets/CronOccurrenceDialog-BPhB9aPK.js","tickerqassets/index-BojVbZw0.js","tickerqassets/index-BXjI2TNL.js","tickerqassets/sleep-B8FjgEV9.js","tickerqassets/CronOccurrenceDialog-CA-EII8O.css","tickerqassets/CRUDCronTickerDialog-cRcWaC0a.js","tickerqassets/useCustomForm-CiMEJ6Pp.js"])))=>i.map(i=>d[i]);
var ce=Object.defineProperty;var de=(o,u,s)=>u in o?ce(o,u,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[u]=s;var p=(o,u,s)=>de(o,typeof u!="symbol"?u+"":u,s);import{d as ue,_ as j,r as F,o as pe,a as fe,c as z,w as ye,b as g,e as r,f as c,u as d,F as Z,n as me,p as ve,g as C,h as k,k as D,i as R,m as ge,t as N,j as ke}from"./index-Byj9w34-.js";import{u as Te,b as S,f as H,c as _e,a as J,T as A,m as K,S as O,C as Ce,_ as he}from"./_plugin-vue_export-helper-CEavA9-_.js";import{n as ee,u as be,i as De,a as Ae,b as we,c as xe,d as Ie,e as Re,f as Se,g as qe,E as te,T as Ee}from"./index-BXjI2TNL.js";import{s as Ge}from"./sleep-B8FjgEV9.js";class $e{constructor(){p(this,"id");p(this,"function");p(this,"expression");p(this,"initIdentifier");p(this,"retryIntervals");p(this,"description");p(this,"requestType");p(this,"createdAt");p(this,"updatedAt");p(this,"retries");p(this,"actions")}}class ae{constructor(){p(this,"date");p(this,"results")}}const Fe=()=>{const o=Te(),u=S("array").FixToResponseModel($e,t=>{var m;return t.requestType=o.getNamespaceOrNull(t.function)??"N/A",t.createdAt=H(t.createdAt),t.updatedAt=H(t.updatedAt),t.initIdentifier=(m=t.initIdentifier)==null?void 0:m.split("_").slice(0,2).join("_"),(t.retryIntervals==null||t.retryIntervals.length==0)&&(t.retries==null||t.retries==0)?t.retryIntervals=[]:(t.retryIntervals==null||t.retryIntervals.length==0)&&t.retries!=null&&t.retries>0?t.retryIntervals=Array(1).fill("30s"):t.retryIntervals=t.retryIntervals.map(L=>_e(L,!1)),t}).FixToHeaders(t=>(t.key==ee(m=>m.actions)&&(t.sortable=!1),ee(m=>m.id,m=>m.retries).includes(t.key)&&(t.visibility=!1),t));return{...u,requestAsync:async()=>await u.sendAsync("GET","cron-tickers")}},Oe=()=>{const o=S("single");return{...o,requestAsync:async(s,t)=>await o.sendAsync("PUT","cron-ticker/:update",{bodyData:t,paramData:{id:s}})}},Ve=()=>{const o=S("single");return{...o,requestAsync:async s=>await o.sendAsync("POST","cron-ticker/:add",{bodyData:s})}},Me=()=>{const o=S("single");return{...o,requestAsync:async s=>await o.sendAsync("DELETE","cron-ticker/:delete",{paramData:{id:s}})}},Pe=()=>{const o=S("array").FixToResponseModel(ae,s=>({...s,date:H(s.date,!1)}));return{...o,requestAsync:async(s,t)=>await o.sendAsync("GET","cron-tickers/:graph-data-range",{paramData:{pastDays:s,futureDays:t}})}},Ne=()=>{const o=S("array").FixToResponseModel(ae,s=>({...s,date:H(s.date,!1)}));return{...o,requestAsync:async(s,t,m)=>await o.sendAsync("GET","cron-tickers/:graph-data-range-id",{paramData:{id:s,pastDays:t,futureDays:m}})}},He=()=>{const o=S("array");return{...o,requestAsync:async()=>await o.sendAsync("GET","cron-tickers/:graph-data")}},V={getCronTickers:Fe,updateCronTicker:Oe,addCronTicker:Ve,deleteCronTicker:Me,getTimeTickersGraphDataRange:Pe,getTimeTickersGraphDataRangeById:Ne,getTimeTickersGraphData:He},Le={class:"d-flex justify-end px-4 mb-2"},Be={key:0},Ue={key:1},je={class:"attempt"},ze={key:0},Je={key:1},Ke={key:0},Qe={key:0},We={key:1},Ye={class:"attempt"},Xe=ue({__name:"CronTicker",setup(o){const u=V.getTimeTickersGraphDataRange(),s=V.getCronTickers(),t=V.getTimeTickersGraphDataRangeById(),m=V.getTimeTickersGraphData(),L=V.deleteCronTicker(),w=J().withComponent(()=>j(()=>import("./ConfirmDialog-CY5nDLOI.js"),__vite__mapDeps([0,1,2,3,4]))),G=J().withComponent(()=>j(()=>import("./CronOccurrenceDialog-BPhB9aPK.js"),__vite__mapDeps([5,2,3,1,4,6,7,8,9]))),f=J().withComponent(()=>j(()=>import("./CRUDCronTickerDialog-cRcWaC0a.js"),__vite__mapDeps([10,1,2,3,4,11,7,8]))),Q=F(null),h=F(void 0),ne=async()=>{var a;w.close(),await L.requestAsync((a=w.propData)==null?void 0:a.id).then(async()=>{h.value!=null&&(T.value.title.subtext="Job statuses for all Cron Tickers",await u.requestAsync(-3,3).then(e=>$(e)))})},se=async()=>{await m.requestAsync().then(a=>{const e=a.sort((i,y)=>i.item2-y.item2).map(i=>({name:`${O[i.item1]} (${i.item2})`,value:i.item2,itemStyle:{color:B[O[i.item1]]||"#999"}}));W.value.series[0].data=e})},$=a=>{const e=a.map(l=>l.date);T.value.xAxis.data=e;const i=new Set;a.forEach(({results:l})=>{l.forEach(({item1:_})=>i.add(_))});const y=Array.from(i),v=new Map;y.forEach(l=>{v.set(l,Array(e.length).fill(0))}),a.forEach(({date:l,results:_})=>{const U=e.indexOf(l);_.forEach(({item1:n,item2:I})=>{const E=v.get(n);E&&(E[U]=I)})});const M=Array.from(v.entries()).map(([l,_])=>({data:_,name:O[l]||`Unknown ${l}`,type:"line",lineStyle:{color:B[O[l]]},itemStyle:{color:B[O[l]]}})),P=["Idle","Queued","InProgress","Done","DueDone","Failed","Cancelled"],x=M.filter(l=>l.data.some(_=>_>0)).map(l=>l.name);T.value.legend={show:!0,textStyle:{color:"#fff"},selected:Object.fromEntries(P.map(l=>[l,x.includes(l)]))},T.value.series=M},oe=async(a,e,i,y)=>{if(e==h.value){h.value=void 0,T.value.title.subtext="Job statuses for all Cron Tickers",T.value.series=[],await u.requestAsync(i,y).then(v=>$(v)),q.value=[-3,3];return}else h.value=void 0,T.value.series=[],T.value.title.subtext=`Job statuses for selected: ${a}`,await t.requestAsync(e,i,y).then(v=>$(v)),q.value=[-3,3],await Ge(100).then(()=>{h.value=e})},re=async()=>{A.onReceiveAddCronTicker(a=>{s.addToResponse(a)}),A.onReceiveUpdateCronTicker(a=>{var e;s.updateByKey("id",a,[]),f.isOpen&&((e=f.propData)==null?void 0:e.id)==a.id&&(f.setPropData({...a,isFromDuplicate:!1}),me(()=>{var i;(i=Q.value)==null||i.resetForm()}))}),A.onReceiveDeleteCronTicker(a=>{var e;f.isOpen&&((e=f.propData)==null?void 0:e.id)==a&&(f.close(),f.propData={}),s.removeFromResponse("id",a)})};pe(async()=>{await se(),await s.requestAsync(),await A.startConnection(),await re()}),fe(()=>{A.stopReceiver(K.onReceiveAddCronTicker),A.stopReceiver(K.onReceiveUpdateCronTicker),A.stopReceiver(K.onReceiveDeleteCronTicker)}),be([De,Ae,we,xe,Ie,Re,Se,qe]),ve(Ee,"dark");const T=F({backgroundColor:"#212121",title:{subtext:"Job statuses for all Cron Tickers",left:"center",top:"top",padding:[25,0,0,0],subtextStyle:{color:"#aaa",fontSize:14}},tooltip:{trigger:"axis"},legend:{show:!0,textStyle:{color:"#fff"},selected:{}},grid:{left:"3%",right:"3%",bottom:"3%",containLabel:!0},toolbox:{feature:{saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,data:[],axisLabel:{color:"#ccc"},axisLine:{lineStyle:{color:"#666"}}},yAxis:{type:"value",min:0,axisLine:{show:!1},axisTick:{show:!1},splitLine:{show:!0,lineStyle:{color:"#444",width:1}}},series:[]}),W=F({backgroundColor:"#212121",title:{text:"Total Cron Tickers",subtext:"Pie chart of job statuses",left:"center",top:"top",textStyle:{color:"#fff",fontSize:20,fontWeight:"bold"},subtextStyle:{color:"#aaa",fontSize:14}},tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},legend:{show:!1},series:[{type:"pie",radius:["40%","70%"],center:["50%","100%"],startAngle:180,endAngle:360,data:[]}]}),B={Idle:"#A9A9A9",Queued:"#00CED1",InProgress:"#6495ED",Done:"#32CD32",DueDone:"#008000",Failed:"#FF0000",Cancelled:"#FFD700"},q=F([-3,3]),b=z({get:()=>q.value,set:([a,e])=>{a=Math.max(-10,Math.min(a,-1)),e=Math.max(1,Math.min(e,10)),a>=e&&(a=-1,e=1),q.value=[a,e]}}),Y=z({get:()=>b.value[0],set:a=>{b.value=[a||-1,b.value[1]]}}),X=z({get:()=>b.value[1],set:a=>{b.value=[b.value[0],a||1]}});function ie(a,e){let i;return(...y)=>{clearTimeout(i),i=setTimeout(()=>a(...y),e)}}const le=ie(async([a,e])=>{h.value==null?await u.requestAsync(a,e).then(i=>$(i)):await t.requestAsync(h.value,a,e).then(i=>$(i))},100);return ye(()=>q.value.toString(),()=>{le([...q.value])},{immediate:!0,flush:"post"}),(a,e)=>{const i=C("v-sheet"),y=C("v-col"),v=C("v-text-field"),M=C("v-range-slider"),P=C("v-row"),x=C("v-btn"),l=C("v-icon"),_=C("v-data-table"),U=C("v-container");return k(),g(Z,null,[r(U,{fluid:""},{default:c(()=>[r(P,null,{default:c(()=>[r(y,null,{default:c(()=>[r(P,null,{default:c(()=>[r(y,{style:{"background-color":"#212121"},cols:"4"},{default:c(()=>[r(i,{"min-height":"35vh",rounded:"lg"},{default:c(()=>[r(d(te),{class:"chart",option:W.value,autoresize:""},null,8,["option"])]),_:1})]),_:1}),r(y,{style:{"background-color":"#212121"},cols:"8"},{default:c(()=>[r(i,{"min-height":"35vh",rounded:"lg"},{default:c(()=>[r(M,{modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=n=>b.value=n),max:10,min:-10,step:1,"show-ticks":"always",ticks:{"-10":"Past",10:"Future"},"hide-spin-buttons":"",class:"align-center pb-2","hide-details":"",density:"compact","thumb-size":"12"},{prepend:c(()=>[r(v,{modelValue:Y.value,"onUpdate:modelValue":[e[0]||(e[0]=n=>Y.value=n),e[1]||(e[1]=n=>n>0?0:2)],density:"compact",style:{width:"30px"},type:"number",variant:"underlined","hide-details":"","single-line":""},null,8,["modelValue"])]),append:c(()=>[r(v,{modelValue:X.value,"onUpdate:modelValue":e[2]||(e[2]=n=>X.value=n),density:"compact",style:{width:"30px"},type:"number",variant:"underlined","hide-details":"","single-line":""},null,8,["modelValue"])]),_:1},8,["modelValue"]),r(d(te),{class:"chart",option:T.value,autoresize:""},null,8,["option"])]),_:1})]),_:1})]),_:1})]),_:1}),r(y,{cols:"12"},{default:c(()=>[r(i,{rounded:"lg",class:"pt-5"},{default:c(()=>[D("div",Le,[r(x,{rounded:"lg",variant:"tonal","prepend-icon":"mdi-plus",color:"primary",onClick:e[4]||(e[4]=n=>d(f).open({isFromDuplicate:!0}))},{default:c(()=>e[8]||(e[8]=[R(" Add New ")])),_:1})]),r(_,{headers:d(s).headers.value,loading:d(s).loader.value,items:d(s).response.value,"item-value":"id","item-class":"custom-row-class",density:"compact"},{"item.retryIntervals":c(({item:n})=>[n.retryIntervals==null||n.retryIntervals.length==0?(k(),g("span",Be,e[9]||(e[9]=[D("span",null,"N/A",-1)]))):(k(),g("span",Ue,[e[12]||(e[12]=R(" [ ")),(k(!0),g(Z,null,ge(n.retryIntervals,(I,E)=>(k(),g("span",{key:E},[D("span",je,"#"+N(E+1),1),e[10]||(e[10]=D("span",{class:"retry-preview"},"⇾",-1)),D("span",null,N(I),1),E<n.retryIntervals.length-1?(k(),g("span",ze,", ")):(k(),g("span",Je))]))),128)),n.retries>n.retryIntervals.length?(k(),g("span",Ke,[n.retryIntervals.length<n.retries-1?(k(),g("span",Qe,", ...")):(k(),g("span",We,", ")),D("span",Ye,"#"+N(n.retries),1),e[11]||(e[11]=D("span",{class:"retry-preview"},"⇾",-1)),D("span",null,N(n.retryIntervals[n.retryIntervals.length-1]),1)])):ke("",!0),e[13]||(e[13]=R(" ] "))]))]),"item.actions":c(({item:n})=>[r(x,{icon:"",density:"comfortable",onClick:I=>oe(n.function,n.id,-3,3)},{default:c(()=>[r(l,{color:h.value==n.id?"grey":"light-blue"},{default:c(()=>e[14]||(e[14]=[R("mdi-chart-areaspline")])),_:2},1032,["color"])]),_:2},1032,["onClick"]),r(x,{onClick:I=>d(G).open({id:n.id,retries:n.retries,retryIntervals:n.retryIntervals}),icon:"",density:"comfortable"},{default:c(()=>[r(l,{color:"light-blue"},{default:c(()=>e[15]||(e[15]=[R("mdi-folder-open")])),_:1})]),_:2},1032,["onClick"]),r(x,{icon:"",density:"comfortable",onClick:I=>d(f).open({...n,isFromDuplicate:!1})},{default:c(()=>[r(l,{color:"amber"},{default:c(()=>e[16]||(e[16]=[R("mdi-pencil")])),_:1})]),_:2},1032,["onClick"]),r(x,{onClick:I=>d(w).open({...new(d(Ce)),id:n.id,showWarningAlert:n.initIdentifier!=null,warningAlertMessage:"System-seeded ticker. To remove permanently, delete its cron expression from code."}),icon:"",density:"comfortable"},{default:c(()=>[r(l,{color:"red-lighten-1"},{default:c(()=>e[17]||(e[17]=[R("mdi-delete")])),_:1})]),_:2},1032,["onClick"])]),_:1},8,["headers","loading","items"])]),_:1})]),_:1})]),_:1})]),_:1}),r(d(G).Component,{"ticker-notification-hub":d(A),"dialog-props":d(G).propData,onClose:e[5]||(e[5]=n=>d(G).close()),"is-open":d(G).isOpen},null,8,["ticker-notification-hub","dialog-props","is-open"]),r(d(f).Component,{ref_key:"crudCronTickerDialogRef",ref:Q,"dialog-props":d(f).propData,onClose:e[6]||(e[6]=n=>d(f).close()),"is-open":d(f).isOpen},null,8,["dialog-props","is-open"]),r(d(w).Component,{"is-open":d(w).isOpen,"dialog-props":d(w).propData,onClose:e[7]||(e[7]=n=>d(w).close()),onConfirm:ne},null,8,["is-open","dialog-props"])],64)}}}),Ze=he(Xe,[["__scopeId","data-v-d53f0620"]]),ot=Object.freeze(Object.defineProperty({__proto__:null,default:Ze},Symbol.toStringTag,{value:"Module"}));export{ot as C,V as c};
