import{u as fe,t as ve,c as F,_ as _e}from"./_plugin-vue_export-helper-CEavA9-_.js";import{u as ge}from"./useCustomForm-CiMEJ6Pp.js";import{t as A}from"./TimeTicker-CvGOV9i7.js";import{d as he,w as B,r as J,c as xe,b as O,e as n,f as i,K as j,g as l,L as De,h as g,i as T,u as r,t as S,k as K,s as k,l as q,j as P,M as be}from"./index-Byj9w34-.js";import"./index-BXjI2TNL.js";import"./index-BojVbZw0.js";const Te={class:"text-center pa-4"},ke=["innerHTML"],ye={key:0},qe={key:1},we=he({__name:"CRUDTimeTickerDialogComponent",props:{dialogProps:{type:Object,required:!0},isOpen:{type:Boolean,required:!0,default:!1}},emits:["close","confirm"],setup(R,{expose:G,emit:Q}){const V=fe(),U=ve.getRequestData(),W=A.addTimeTicker(),X=A.updateTimeTicker(),$=Q,s=R;B(()=>s.dialogProps.id,async()=>{await Y(),E()});const Y=async()=>{await U.requestAsync(s.dialogProps.id,1).then(e=>{const t=N(e.result,!1);t==null?m("requestData",""):m("requestData",t)})},N=(e,t=!1)=>{if(e!=null)try{const a=JSON.stringify(JSON.parse(e),null,2);return t?a.replace(/\n/g,"<br>").replace(/ /g,"&nbsp;"):a}catch{return}},Z=e=>{const t=e.split("T")[0],a=e.split("T")[1].split(".")[0];return{datePart:t,timePart:a}},{resetForm:E,handleSubmit:ee,bindField:x,setFieldValue:m,getFieldValue:y,values:h}=ge({initialValues:{exampleData:"",requestData:"",functionName:"",executionDate:void 0,executionTime:"",ignoreDateTime:!1,description:"",retries:0},validationSchema:e=>({functionName:e.string().required("Function name is required"),executionDate:e.date().when("ignoreDateTime",{is:!0,then:t=>t.notRequired(),otherwise:t=>t.required("Date is required")}),executionTime:e.string().when("ignoreDateTime",{is:!0,then:t=>t.notRequired(),otherwise:t=>t.required("Time is required")}),ignoreDateTime:e.boolean()}),onFieldUpdate:{executionTime:(e,t)=>{let a=e.replace(/[^0-9]/g,"");if(!a){t("");return}const o={hh:a.slice(0,2),mm:a.slice(2,4),ss:a.slice(4,6)},d=(D,C)=>Math.min(parseInt(D,10),C).toString().padStart(2,"0"),p={hh:o.mm.length===2?d(o.hh,23):o.hh,mm:o.mm.length===2?d(o.mm,59):o.mm,ss:o.ss.length===2?d(o.ss,59):o.ss},f=[p.hh,a.length>2?`:${p.mm}`:"",a.length>4?`:${p.ss}`:""].join("");t(f)},retries:(e,t)=>{e<u.value.length&&u.value.splice(e),h.retries==u.value.length?w[0].title="Max intervals reached":w[0].title="Select suggested intervals or create one",e<0?t(0):t(e)},executionTime__blur:(e,t)=>{const[a="00",o="00",d="00"]=e.split(":"),p=f=>f.padStart(2,"0");t(`${p(a)}:${p(o)}:${p(d)}`)},functionName:(e,t)=>{var a,o;m("exampleData",(a=V.data.find(d=>d.functionName===e))==null?void 0:a.functionRequestType),s.dialogProps.id==null||s.dialogProps.function!=e?m("requestData",""):m("requestData",N((o=U.response.value)==null?void 0:o.result,!1)),t(e)}},onResetForm:()=>{m("functionName",s.dialogProps.function),s.dialogProps.isFromDuplicate&&s.dialogProps.id!=null?(m("retries",s.dialogProps.retries),m("ignoreDateTime",!0),m("description",s.dialogProps.description),s.dialogProps.retryIntervals.forEach(e=>{u.value.push({id:Math.random().toString(36).substring(2)+Date.now().toString(36),title:F(parseInt(e)),value:parseInt(e)})})):(s.dialogProps.id!=null&&(s.dialogProps.retryIntervals.forEach(e=>{u.value.push({id:Math.random().toString(36).substring(2)+Date.now().toString(36),title:F(parseInt(e)),value:parseInt(e)})}),m("retries",s.dialogProps.retries),m("description",s.dialogProps.description),m("executionDate",new Date(s.dialogProps.executionTime)),m("executionTime",Z(s.dialogProps.executionTime).timePart)),m("ignoreDateTime",!1))},onSubmitForm:(e,t)=>{if(!t){const[a,o,d]=e.executionTime.split(":").map(Number),p=new Date(e.executionDate).setHours(a,o,d,0),f=e.ignoreDateTime?void 0:new Date(p).toISOString();s.dialogProps.isFromDuplicate?W.requestAsync({function:e.functionName,request:e.requestData,executionTime:f,retries:parseInt(`${e.retries}`),description:e.description,intervals:u.value.map(D=>D.value)}).then(()=>{$("confirm")}):X.requestAsync(s.dialogProps.id,{function:e.functionName,request:e.requestData,executionTime:f,retries:parseInt(`${e.retries}`),description:e.description,intervals:u.value.map(D=>D.value)}).then(()=>{$("confirm")})}}}),w=[{header:!0,title:"Select suggested intervals or create one"},{id:1,title:"1 min",value:60},{id:2,title:"5 min",value:300},{id:3,title:"10 min",value:600}],te=(e,t,a)=>{const o=f=>String(f??"").toLowerCase(),d=o(t);return a.raw.header?!0:o(a.raw.title).includes(d)},u=J([]),v=J(null);B(v,()=>{parseInt(v.value)>86400?v.value="86400":parseInt(v.value)<0&&(v.value="0")}),B(u,()=>{if(h.retries==u.value.length?w[0].title="Max intervals reached":w[0].title="Select suggested intervals or create one",h.retries<u.value.length)u.value.pop();else{let e=u.value[u.value.length-1];typeof e=="string"&&(parseInt(e)>86400?e="86400":parseInt(e)<0&&(e="0"),u.value.splice(-1,1,{id:Date.now(),title:F(parseInt(e)),value:parseInt(e)}))}},{deep:!0});const ne=e=>{u.value.splice(e,1)},ie=xe(()=>{var a,o;const e=y("functionName");if(e==null||e=="")return"Select a function to see the request type";const t=(o=(a=V.data)==null?void 0:a.find(d=>d.functionName==e))==null?void 0:o.functionRequestNamespace;return t==""?"No request data":t});return G({resetForm:E}),(e,t)=>{const a=l("v-divider"),o=l("v-card-title"),d=l("v-btn"),p=l("v-card-subtitle"),f=l("v-card-item"),D=l("v-card-text"),C=l("v-card"),H=l("v-container"),_=l("v-col"),ae=l("v-select"),M=l("v-text-field"),I=l("v-chip"),z=l("v-list-item"),oe=l("v-list-subheader"),se=l("v-combobox"),le=l("v-textarea"),re=l("v-date-input"),ue=l("v-checkbox-btn"),L=l("v-row"),ce=l("v-form"),de=l("v-spacer"),me=l("v-dialog"),pe=De("mask");return g(),O("div",Te,[n(me,{modelValue:j(R.isOpen).value,"onUpdate:modelValue":t[4]||(t[4]=c=>j(R.isOpen).value=c),"max-width":"1000",persistent:""},{default:i(()=>[n(C,null,{actions:i(()=>[n(de),n(d,{color:"grey",onClick:t[3]||(t[3]=c=>$("close"))},{default:i(()=>t[8]||(t[8]=[T(" Close ")])),_:1}),n(d,{color:"orange",onClick:r(ee)},{default:i(()=>[T(S(s.dialogProps.isFromDuplicate?s.dialogProps.id==null?"Create":"Clone":"Update"),1)]),_:1},8,["onClick"])]),default:i(()=>[n(a),n(L,null,{default:i(()=>[n(_,{cols:"5"},{default:i(()=>[n(o,{class:"py-4"},{default:i(()=>t[5]||(t[5]=[T(" Example Data ")])),_:1}),n(a),n(H,null,{default:i(()=>[n(C,{class:"mx-auto my-8",elevation:"16","max-width":"344"},{default:i(()=>[n(f,null,{append:i(()=>[n(d,{icon:"mdi-share-outline",onClick:t[0]||(t[0]=c=>r(m)("requestData",r(y)("exampleData")))})]),default:i(()=>[n(o,null,{default:i(()=>t[6]||(t[6]=[T(" Example Data ")])),_:1}),n(p,null,{default:i(()=>[T(S(ie.value),1)]),_:1}),n(a)]),_:1}),n(D,null,{default:i(()=>[K("div",{innerHTML:N(r(y)("exampleData"),!0)},null,8,ke)]),_:1})]),_:1})]),_:1})]),_:1}),n(_,{cols:"7"},{default:i(()=>[n(o,{class:"py-4"},{default:i(()=>[T(S(s.dialogProps.isFromDuplicate?s.dialogProps.id==null?"Add New":"Clone":"Update")+" Time Ticker ",1)]),_:1}),n(a),n(ce,null,{default:i(()=>[n(H,null,{default:i(()=>[n(L,null,{default:i(()=>[n(_,{cols:"6"},{default:i(()=>[n(ae,k(r(x)("functionName"),{"item-title":"functionName","item-value":"functionName",items:r(V).data,variant:"outlined",label:"Functions"}),null,16,["items"])]),_:1}),n(_,{cols:"6"},{default:i(()=>[n(M,k(r(x)("description"),{label:"Short description",variant:"outlined"}),null,16)]),_:1}),n(_,{cols:"4"},{default:i(()=>[n(M,k(r(x)("retries"),{type:"number",label:"Retries",variant:"outlined",min:0,max:10}),null,16)]),_:1}),n(_,{cols:"8"},{default:i(()=>[n(se,{"custom-filter":te,modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=c=>u.value=c),search:v.value,"onUpdate:search":t[2]||(t[2]=c=>v.value=c),items:w,type:"number",min:0,max:86400,label:r(h).retries==0?"Retries: 0 (no intervals)":u.value.length>=1?"Unset intervals use (default: last set)":"Set intervals or (default: 30s)","item-title":c=>c.title,"item-value":c=>c.id,"hide-selected":"",multiple:"","hide-spin-buttons":"",disabled:r(h).retries==0,hint:`Max intervals (retries): ${r(h).retries}`,"persistent-hint":"",variant:"outlined"},{selection:i(({item:c,index:b})=>[c===Object(c)?(g(),q(I,{key:0,text:c.title,size:"small",variant:"flat",closable:"",label:"","onClick:close":Se=>ne(b)},null,8,["text","onClick:close"])):P("",!0)]),item:i(({props:c,item:b})=>[b.raw.header&&v.value?(g(),q(z,{key:0},{default:i(()=>[u.value.length<r(h).retries?(g(),O("span",ye,[n(I,{size:"small",variant:"flat",label:""},{default:i(()=>[T(S(r(F)(parseInt(v.value)))+" "+S(parseInt(v.value)>=86400?"(max value)":""),1)]),_:1}),t[7]||(t[7]=K("span",{class:"ml-3"},"Press enter to add",-1))])):(g(),O("span",qe,[n(I,{text:"Max intervals reached",variant:"plain",size:"small",label:""})]))]),_:1})):b.raw.header?(g(),q(oe,{key:1,title:b.title},null,8,["title"])):P("",!0),!b.raw.header&&u.value.length<r(h).retries?(g(),q(z,{key:2,onClick:c.onClick},{default:i(()=>[n(I,{text:b.raw.title,variant:"flat",label:""},null,8,["text"])]),_:2},1032,["onClick"])):P("",!0)]),_:1},8,["modelValue","search","label","item-title","item-value","disabled","hint"])]),_:1}),n(_,{cols:"12"},{default:i(()=>[n(le,k({rows:"10"},r(x)("requestData"),{label:"Request Data",variant:"outlined",disabled:N(r(y)("exampleData"),!1)==null}),null,16,["disabled"])]),_:1}),r(y)("ignoreDateTime")?P("",!0):(g(),q(_,{key:0,cols:"6"},{default:i(()=>[n(re,k(r(x)("executionDate",c=>new Date(c)),{label:"Date input",min:new Date().toISOString().split("T")[0],"prepend-icon":"","prepend-inner-icon":"$calendar",variant:"outlined"}),null,16,["min"])]),_:1})),r(y)("ignoreDateTime")?P("",!0):(g(),q(_,{key:1,cols:"6"},{default:i(()=>[be(n(M,k(r(x)("executionTime"),{label:"Enter Time (HH:mm:ss)",placeholder:"HH:mm:ss","prepend-icon":"","prepend-inner-icon":"mdi-clock-outline",variant:"outlined"}),null,16),[[pe,"##:##:##"]])]),_:1})),n(_,null,{default:i(()=>[n(ue,k({label:"Execute immediately (with a one-second delay)",class:"pe-2"},r(x)("ignoreDateTime")),null,16)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),Ve=_e(we,[["__scopeId","data-v-2585e72f"]]);export{Ve as default};
