const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["tickerqassets/ConfirmDialog-CY5nDLOI.js","tickerqassets/_plugin-vue_export-helper-CEavA9-_.js","tickerqassets/index-Byj9w34-.js","tickerqassets/index-9ePG4d-9.css","tickerqassets/_plugin-vue_export-helper-BbU2hx5y.css"])))=>i.map(i=>d[i]);
var M=Object.defineProperty;var z=(i,y,t)=>y in i?M(i,y,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[y]=t;var l=(i,y,t)=>z(i,typeof y!="symbol"?y+"":y,t);import{d as J,_ as W,o as X,a as Y,w,b as d,e as g,u as s,k as c,f as v,K as q,F as R,g as _,h as u,i as C,t as f,m as Z,q as x,j as E}from"./index-Byj9w34-.js";import{b as D,S as n,c as ee,f as O,a as te,t as se,m as H,_ as ne}from"./_plugin-vue_export-helper-CEavA9-_.js";import{f as re}from"./index-BojVbZw0.js";import{n as I}from"./index-BXjI2TNL.js";import{s as N}from"./sleep-B8FjgEV9.js";class ae{constructor(){l(this,"id");l(this,"status");l(this,"retryIntervals");l(this,"lockHolder");l(this,"lockedAt");l(this,"executionTime");l(this,"executionTimeFormatted");l(this,"executedAt");l(this,"elapsedTime");l(this,"retryCount");l(this,"actions")}}class oe{constructor(){l(this,"date");l(this,"results");l(this,"type");l(this,"statuses")}}const ie=()=>{const i=D("array").FixToResponseModel(ae,t=>(t.status=n[t.status],(t.executedAt!=null||t.executedAt!=null)&&(t.executedAt=`${re(t.executedAt)} (took ${ee(t.elapsedTime,!0)})`),t.executionTimeFormatted=O(t.executionTime),t.lockedAt=O(t.lockedAt),t)).FixToHeaders(t=>(t.key==I(a=>a.actions)&&(t.sortable=!1),I(a=>a.id,a=>a.elapsedTime,a=>a.executionTime,a=>a.retryCount).includes(t.key)&&(t.visibility=!1),I(a=>a.executedAt)==t.key&&(t.title="Executed At (Elapsed Time)"),I(a=>a.executionTimeFormatted)==t.key&&(t.title="Execution Time"),t)).ReOrganizeResponse(t=>t.sort((a,T)=>new Date(T.executionTime).getTime()-new Date(a.executionTime).getTime()));return{...i,requestAsync:async t=>await i.sendAsync("GET","cron-ticker-occurrences/:cronTickerId",{paramData:{cronTickerId:t}})}},ce=()=>{const i=D("single");return{...i,requestAsync:async t=>await i.sendAsync("DELETE","cron-ticker-occurrence/:delete",{paramData:{id:t}})}},le=()=>{const i=D("array").FixToResponseModel(oe,t=>({...t,date:O(t.date),type:"line",statuses:t.results.map(a=>n[a.item1])}));return{...i,requestAsync:async t=>await i.sendAsync("GET","cron-ticker-occurrences/:cronTickerId/:graph-data",{paramData:{cronTickerId:t}})}},F={getByCronTickerId:ie,deleteCronTickerOccurrence:ce,getCronTickerOccurrenceGraphData:le},de={class:"text-center pa-4"},ue={key:0,class:"snippet","data-title":"dot-carousel"},pe={key:1,class:"text-center"},ye={key:0},ve={key:1},ge={class:"attempt"},ke={key:0},fe={key:0},_e={key:0},Ce={key:0,class:"attempt"},me={key:1},Ie={class:"attempt"},Te={key:2},Pe={key:3},Ae={key:1},be={key:2},xe={class:"attempt"},Oe=J({__name:"CronOccurrenceDialog",props:{dialogProps:{type:Object,required:!0},tickerNotificationHub:{type:Object,required:!0},isOpen:{type:Boolean,required:!0}},emits:["close"],setup(i,{emit:y}){const t=te().withComponent(()=>W(()=>import("./ConfirmDialog-CY5nDLOI.js"),__vite__mapDeps([0,1,2,3,4]))),a=F.getByCronTickerId(),T=se.requestCancel(),B=F.deleteCronTickerOccurrence(),o=i,h=y,G=async()=>{o.tickerNotificationHub.onReceiveUpdateCronTickerOccurrence(p=>{a.updateByKey("id",p,[])}),o.tickerNotificationHub.onReceiveAddCronTickerOccurrence(p=>{a.addToResponse(p),a.updatePropertyByKey("id",p.id,"retryIntervals",o.dialogProps.retryIntervals)})};X(()=>{G()}),Y(()=>{o.tickerNotificationHub.stopReceiver(H.onReceiveUpdateCronTickerOccurrence),o.tickerNotificationHub.stopReceiver(H.onReceiveAddCronTickerOccurrence)}),w(()=>o.isOpen,()=>{o.isOpen&&o.dialogProps.id!=null?o.tickerNotificationHub.joinGroup(o.dialogProps.id):!o.isOpen&&o.dialogProps.id!=null&&o.tickerNotificationHub.leaveGroup(o.dialogProps.id)}),w(()=>o.dialogProps.id,async()=>{o.dialogProps.id!=null&&await a.requestAsync(o.dialogProps.id).then(()=>{a.updateProperty("retryIntervals",o.dialogProps.retryIntervals)})});const k=(p,r)=>p==n[r],S=async p=>{await T.requestAsync(p).then(async()=>await N(100)).then(async()=>{await a.requestAsync(o.dialogProps.id)})},V=async()=>{var p;t.close(),await B.requestAsync((p=t.propData)==null?void 0:p.data).then(async()=>await N(100)).then(async()=>{await a.requestAsync(o.dialogProps.id)})},$={Idle:"#A9A9A9",Queued:"#00CED1",InProgress:"#6495ED",Done:"#32CD32",DueDone:"#008000",Failed:"#FF0000",Cancelled:"#FFD700"},j=p=>({style:`color:${$[p.item.status]}`});return(p,r)=>{const P=_("v-icon"),A=_("v-btn"),Q=_("v-card-title"),L=_("v-data-table"),U=_("v-card"),K=_("v-dialog");return u(),d(R,null,[g(s(t).Component,{"is-open":s(t).isOpen,onClose:r[0]||(r[0]=e=>s(t).close()),onConfirm:V},null,8,["is-open"]),c("div",de,[g(K,{modelValue:q(i.isOpen).value,"onUpdate:modelValue":r[2]||(r[2]=e=>q(i.isOpen).value=e),width:"auto"},{default:v(()=>[g(U,null,{default:v(()=>[g(Q,{class:"d-flex justify-space-between align-center"},{default:v(()=>[r[4]||(r[4]=c("span",{class:"headline"},"Cron Ticker Occurrences",-1)),g(A,{onClick:r[1]||(r[1]=e=>h("close")),variant:"outlined","aria-label":"Close"},{default:v(()=>[g(P,null,{default:v(()=>r[3]||(r[3]=[C("mdi-close")])),_:1})]),_:1})]),_:1}),g(L,{headers:s(a).headers.value,loading:s(a).loader.value,items:s(a).response.value,"item-value":"Id","row-props":j,key:"Id"},{"item.ExecutedAt":v(({item:e})=>[k(e.status,s(n).InProgress)?(u(),d("div",ue,r[5]||(r[5]=[c("div",{class:"stage"},[c("div",{class:"dot-carousel"})],-1)]))):(u(),d("div",pe,f(k(e.status,s(n).Cancelled)||k(e.status,s(n).Queued)?"N/A":e.executedAt),1))]),"item.retryIntervals":v(({item:e})=>[e.retryIntervals==null||e.retryIntervals.length==0?(u(),d("span",ye,r[6]||(r[6]=[c("span",null,"N/A",-1)]))):(u(),d("span",ve,[r[10]||(r[10]=C(" [ ")),(u(!0),d(R,null,Z(e.retryIntervals,(b,m)=>(u(),d("span",{key:m},[c("span",{class:x(m==e.retryCount-1?e.status==s(n)[s(n).InProgress]?"interval interval-running":e.status!=s(n)[s(n).InProgress]||e.status!=s(n)[s(n).Idle]||e.status!=s(n)[s(n).Queued]?"active-attempt":"interval":"interval")},[c("span",ge,"#"+f(m+1),1),r[7]||(r[7]=c("span",{class:"retry-preview"},"⇾",-1)),c("span",null,f(b),1)],2),m<e.retryIntervals.length-1?(u(),d("span",ke,", ")):E("",!0)]))),128)),o.dialogProps.retries>e.retryIntervals.length?(u(),d("span",fe,[e.retryCount>e.retryIntervals.length&&e.retryCount!=e.retryIntervals.length&&e.retryCount!=o.dialogProps.retries?(u(),d("span",_e,[e.retryCount!=e.retryIntervals.length+1?(u(),d("span",Ce,", ... ")):(u(),d("span",me,", ")),c("span",{class:x(e.status==s(n)[s(n).InProgress]?"interval interval-running":e.status!=s(n)[s(n).InProgress]||e.status!=s(n)[s(n).Idle]||e.status!=s(n)[s(n).Queued]?"active-attempt":"interval")},[c("span",Ie,"#"+f(e.retryCount),1),r[8]||(r[8]=c("span",{class:"retry-preview"},"⇾",-1)),c("span",null,f(e.retryIntervals[e.retryIntervals.length-1]),1)],2),e.retryCount+1!=o.dialogProps.retries?(u(),d("span",Te,", ...")):(u(),d("span",Pe,", "))])):o.dialogProps.retries==2?(u(),d("span",Ae,", ")):(u(),d("span",be,", ...")),c("span",{class:x(e.retryCount==o.dialogProps.retries?e.status==s(n)[s(n).InProgress]?"interval interval-running":e.status!=s(n)[s(n).InProgress]||e.status!=s(n)[s(n).Idle]||e.status!=s(n)[s(n).Queued]?"active-attempt":"interval":"interval")},[c("span",xe,"#"+f(o.dialogProps.retries),1),r[9]||(r[9]=c("span",null,"⇾",-1)),c("span",null,f(e.retryIntervals[e.retryIntervals.length-1]),1)],2)])):E("",!0),r[11]||(r[11]=C(" ] "))]))]),"item.actions":v(({item:e})=>[g(A,{onClick:b=>S(e.id),disabled:!k(e.status,s(n).InProgress),icon:"",variant:k(e.status,s(n).InProgress)?"elevated":"text",density:"comfortable"},{default:v(()=>[g(P,{color:k(e.status,s(n).InProgress)?"blue":"grey"},{default:v(()=>r[12]||(r[12]=[C("mdi-cancel")])),_:2},1032,["color"])]),_:2},1032,["onClick","disabled","variant"]),g(A,{onClick:b=>s(t).open({data:e.id}),disabled:k(e.status,s(n).InProgress),variant:k(e.status,s(n).InProgress)?"text":"elevated",icon:"",density:"comfortable"},{default:v(()=>[g(P,{color:"red"},{default:v(()=>r[13]||(r[13]=[C("mdi-delete")])),_:1})]),_:2},1032,["onClick","disabled","variant"])]),_:1},8,["headers","loading","items"])]),_:1})]),_:1},8,["modelValue"])])],64)}}}),Ne=ne(Oe,[["__scopeId","data-v-ccf3be4d"]]);export{Ne as default};
