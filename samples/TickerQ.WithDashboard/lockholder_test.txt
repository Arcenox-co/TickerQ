Using launch settings from /Users/isolomatov/Sources/Demo/TickerQ/samples/TickerQ.WithDashboard/Properties/launchSettings.json...
Building...
/Users/isolomatov/Sources/Demo/TickerQ/src/TickerQ.Utilities/DashboardDtos/AddTimeTickerRequest.cs(11,22): warning CS8632: The annotation for nullable reference types should only be used in code within a '#nullable' annotations context. [/Users/isolomatov/Sources/Demo/TickerQ/src/TickerQ.Utilities/TickerQ.Utilities.csproj]
/Users/isolomatov/Sources/Demo/TickerQ/src/TickerQ.Utilities/DashboardDtos/AddCronTickerRequest.cs(9,22): warning CS8632: The annotation for nullable reference types should only be used in code within a '#nullable' annotations context. [/Users/isolomatov/Sources/Demo/TickerQ/src/TickerQ.Utilities/TickerQ.Utilities.csproj]
/Users/isolomatov/Sources/Demo/TickerQ/src/TickerQ.Utilities/DashboardDtos/AddTimeTickerRequest.cs(12,21): warning CS8632: The annotation for nullable reference types should only be used in code within a '#nullable' annotations context. [/Users/isolomatov/Sources/Demo/TickerQ/src/TickerQ.Utilities/TickerQ.Utilities.csproj]
/Users/isolomatov/Sources/Demo/TickerQ/src/TickerQ.Utilities/DashboardDtos/AddCronTickerRequest.cs(11,22): warning CS8632: The annotation for nullable reference types should only be used in code within a '#nullable' annotations context. [/Users/isolomatov/Sources/Demo/TickerQ/src/TickerQ.Utilities/TickerQ.Utilities.csproj]
/Users/isolomatov/Sources/Demo/TickerQ/src/TickerQ.Utilities/DashboardDtos/AddCronTickerRequest.cs(12,21): warning CS8632: The annotation for nullable reference types should only be used in code within a '#nullable' annotations context. [/Users/isolomatov/Sources/Demo/TickerQ/src/TickerQ.Utilities/TickerQ.Utilities.csproj]
/Users/isolomatov/Sources/Demo/TickerQ/src/TickerQ.Utilities/DashboardDtos/UpdateCronTickerRequest.cs(9,22): warning CS8632: The annotation for nullable reference types should only be used in code within a '#nullable' annotations context. [/Users/isolomatov/Sources/Demo/TickerQ/src/TickerQ.Utilities/TickerQ.Utilities.csproj]
/Users/isolomatov/Sources/Demo/TickerQ/src/TickerQ.Utilities/DashboardDtos/UpdateTimeTickerRequest.cs(11,22): warning CS8632: The annotation for nullable reference types should only be used in code within a '#nullable' annotations context. [/Users/isolomatov/Sources/Demo/TickerQ/src/TickerQ.Utilities/TickerQ.Utilities.csproj]
/Users/isolomatov/Sources/Demo/TickerQ/src/TickerQ.Utilities/DashboardDtos/UpdateCronTickerRequest.cs(11,22): warning CS8632: The annotation for nullable reference types should only be used in code within a '#nullable' annotations context. [/Users/isolomatov/Sources/Demo/TickerQ/src/TickerQ.Utilities/TickerQ.Utilities.csproj]
/Users/isolomatov/Sources/Demo/TickerQ/src/TickerQ.Utilities/DashboardDtos/UpdateTimeTickerRequest.cs(12,21): warning CS8632: The annotation for nullable reference types should only be used in code within a '#nullable' annotations context. [/Users/isolomatov/Sources/Demo/TickerQ/src/TickerQ.Utilities/TickerQ.Utilities.csproj]
/Users/isolomatov/Sources/Demo/TickerQ/src/TickerQ.Utilities/DashboardDtos/UpdateCronTickerRequest.cs(12,21): warning CS8632: The annotation for nullable reference types should only be used in code within a '#nullable' annotations context. [/Users/isolomatov/Sources/Demo/TickerQ/src/TickerQ.Utilities/TickerQ.Utilities.csproj]
/Users/isolomatov/Sources/Demo/TickerQ/samples/TickerQ.WithDashboard/Jobs/CleanupLogs2.cs(9,27): warning CS1998: This async method lacks 'await' operators and will run synchronously. Consider using the 'await' operator to await non-blocking API calls, or 'await Task.Run(...)' to do CPU-bound work on a background thread. [/Users/isolomatov/Sources/Demo/TickerQ/samples/TickerQ.WithDashboard/TickerQ.WithDashboard.csproj]
üîê AddCronTickerAsync LockHolder=Igors-MacBook-Pro, Status=Idle
crit: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
      üö®üö®üö® ISSUE-195-FIX: InsertCronTickerOccurrences CALLED üö®üö®üö®
crit: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
      üîç DbContext Instance: 48198266
crit: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
      üìã Full Stack Trace:
crit: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
        üî∏ [0] <InsertCronTickerOccurrences>d__44.MoveNext in /Users/isolomatov/Sources/Demo/TickerQ/src/TickerQ.EntityFrameworkCore/Infrastructure/TickerEFCorePersistenceProvider.cs:949
crit: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
        üî∏ [1] AsyncMethodBuilderCore.Start in Unknown:0
crit: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
        üî∏ [2] TickerEfCorePersistenceProvider`3.InsertCronTickerOccurrences in Unknown:0
crit: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
        üî∏ [3] <AddCronTickerAsync>d__8.MoveNext in Unknown:0
crit: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
        üî∏ [4] AsyncStateMachineBox`1.ExecutionContextCallback in Unknown:0
crit: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
        üî∏ [5] ExecutionContext.RunInternal in Unknown:0
crit: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
        üî∏ [6] AsyncStateMachineBox`1.MoveNext in Unknown:0
crit: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
        üî∏ [7] AwaitTaskContinuation.RunOrScheduleAction in Unknown:0
crit: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
        üî∏ [8] Task.RunContinuations in Unknown:0
crit: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
        üî∏ [9] Task`1.TrySetResult in Unknown:0
crit: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
      üö® Processing 1 CronTickerOccurrences üö®
dbug: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
      Successfully inserted occurrence for CronTickerId=8c04de5d-38c5-484d-b4d7-98e94d44da41, ExecutionTime=2025-09-02 18:02:00
warn: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
      ‚úÖ BATCH COMPLETE: Total=1, Success=1, Duplicates=0, Failed=0
info: Microsoft.Hosting.Lifetime[14]
      Now listening on: http://localhost:5149
info: Microsoft.Hosting.Lifetime[0]
      Application started. Press Ctrl+C to shut down.
info: Microsoft.Hosting.Lifetime[0]
      Hosting environment: Development
info: Microsoft.Hosting.Lifetime[0]
      Content root path: /Users/isolomatov/Sources/Demo/TickerQ/samples/TickerQ.WithDashboard
üßπ CLEANUP_TOKEN: CleanupLogs2 executing
cleanup_example_file.txt
üîë LockHolder=Igors-MacBook-Pro, occurrenceList.Count=0
crit: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
      üö®üö®üö® ISSUE-195-FIX: InsertCronTickerOccurrences CALLED üö®üö®üö®
crit: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
      üîç DbContext Instance: 16207305
crit: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
      üìã Full Stack Trace:
crit: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
        üî∏ [0] <InsertCronTickerOccurrences>d__44.MoveNext in /Users/isolomatov/Sources/Demo/TickerQ/src/TickerQ.EntityFrameworkCore/Infrastructure/TickerEFCorePersistenceProvider.cs:949
crit: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
        üî∏ [1] AsyncMethodBuilderCore.Start in Unknown:0
crit: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
        üî∏ [2] TickerEfCorePersistenceProvider`3.InsertCronTickerOccurrences in Unknown:0
crit: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
        üî∏ [3] <RetrieveNextCronTickersAsync>d__12.MoveNext in /Users/isolomatov/Sources/Demo/TickerQ/src/TickerQ.Utilities/Managers/InternalTickerManager.cs:251
crit: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
        üî∏ [4] AsyncStateMachineBox`1.ExecutionContextCallback in Unknown:0
crit: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
        üî∏ [5] ExecutionContext.RunInternal in Unknown:0
crit: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
        üî∏ [6] AsyncStateMachineBox`1.MoveNext in Unknown:0
crit: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
        üî∏ [7] AwaitTaskContinuation.RunOrScheduleAction in Unknown:0
crit: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
        üî∏ [8] Task.RunContinuations in Unknown:0
crit: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
        üî∏ [9] Task`1.TrySetResult in Unknown:0
crit: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
      üö® Processing 3 CronTickerOccurrences üö®
dbug: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
      Successfully inserted occurrence for CronTickerId=52c4f744-7428-4422-9d04-dba9022a6f10, ExecutionTime=2025-09-02 18:02:00
dbug: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
      Successfully inserted occurrence for CronTickerId=35229b60-c245-4e13-bb80-6a2789529f7a, ExecutionTime=2025-09-02 18:02:00
fail: Microsoft.EntityFrameworkCore.Database.Command[20102]
      Failed executing DbCommand (5ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = Guid), @p2='?' (DbType = Int64), @p3='?', @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?', @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32)], CommandType='Text', CommandTimeout='30']
      INSERT INTO ticker."CronTickerOccurrences" ("Id", "CronTickerId", "ElapsedTime", "Exception", "ExecutedAt", "ExecutionTime", "LockHolder", "LockedAt", "RetryCount", "Status")
      VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);
fail: Microsoft.EntityFrameworkCore.Update[10000]
      An exception occurred in the database while saving changes for context type 'TickerQ.WithDashboard.Data.TickerQDbContext'.
      Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
       ---> Npgsql.PostgresException (0x80004005): 23505: duplicate key value violates unique constraint "UQ_CronTickerId_ExecutionTime"
      
      DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
         at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
         at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
         at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
         at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
         at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
         at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
         at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
        Exception data:
          Severity: ERROR
          SqlState: 23505
          MessageText: duplicate key value violates unique constraint "UQ_CronTickerId_ExecutionTime"
          Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
          SchemaName: ticker
          TableName: CronTickerOccurrences
          ConstraintName: UQ_CronTickerId_ExecutionTime
          File: nbtinsert.c
          Line: 663
          Routine: _bt_check_unique
         --- End of inner exception stack trace ---
         at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
         at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
      Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
       ---> Npgsql.PostgresException (0x80004005): 23505: duplicate key value violates unique constraint "UQ_CronTickerId_ExecutionTime"
      
      DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
         at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
         at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
         at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
         at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
         at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
         at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
         at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
        Exception data:
          Severity: ERROR
          SqlState: 23505
          MessageText: duplicate key value violates unique constraint "UQ_CronTickerId_ExecutionTime"
          Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
          SchemaName: ticker
          TableName: CronTickerOccurrences
          ConstraintName: UQ_CronTickerId_ExecutionTime
          File: nbtinsert.c
          Line: 663
          Routine: _bt_check_unique
         --- End of inner exception stack trace ---
         at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
         at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
warn: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
      Constraint violation handled gracefully for CronTickerId=8c04de5d-38c5-484d-b4d7-98e94d44da41, ExecutionTime=2025-09-02 18:02:00
warn: TickerQ.EntityFrameworkCore.Infrastructure.TickerEfCorePersistenceProvider[0]
      ‚úÖ BATCH COMPLETE: Total=3, Success=2, Duplicates=0, Failed=1
info: Microsoft.Hosting.Lifetime[0]
      Application is shutting down...
